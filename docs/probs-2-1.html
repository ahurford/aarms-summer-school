<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="James Watmough">

<title>Problem 2.1: From Models to Forecasts</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="BBSchoolProb2-1_files/libs/clipboard/clipboard.min.js"></script>
<script src="BBSchoolProb2-1_files/libs/quarto-html/quarto.js"></script>
<script src="BBSchoolProb2-1_files/libs/quarto-html/popper.min.js"></script>
<script src="BBSchoolProb2-1_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="BBSchoolProb2-1_files/libs/quarto-html/anchor.min.js"></script>
<link href="BBSchoolProb2-1_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="BBSchoolProb2-1_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="BBSchoolProb2-1_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="BBSchoolProb2-1_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="BBSchoolProb2-1_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Problem 2.1: From Models to Forecasts</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>James Watmough </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="exploring-the-discrete-logistic" class="level1">
<h1>Exploring the Discrete Logistic</h1>
<section id="using-eulers-method" class="level2">
<h2 class="anchored" data-anchor-id="using-eulers-method">Using Euler’s Method</h2>
<p>Our starting point for forecasting projects is often a ‘classic’ deterministic compartmental model (aka ODE model). Even though these might be simple, we almost always base our forecasts on numerical simulations. This problem set explores a few side-effects of discritizing an ODE model. Along the way we also get to think carefully about the processes modelled by the logistic equation.</p>
<p>Consider the classic logistic ODE model <span class="math display">\[\frac{dN}{dt} = rN(1-N/K)\]</span></p>
<p>This is a phenomenological model. It is a simple, 2-parameter ODE model that produces <em>logistic solutions</em>: with initial conditions, <span class="math inline">\(N(0)\)</span>, between 0 and <span class="math inline">\(K\)</span>, the solution increases monotonically to the <em>carrying capacity</em>, <span class="math inline">\(K\)</span>. The <em>processes</em> behind the carrying capacity are not explicitly modelled, so we view the parameter <span class="math inline">\(K\)</span> and the logistic term <span class="math inline">\(N(1-N/K)\)</span> as phenomenological rather than mechanistic, or process-based.</p>
<p>To set up our forecast (i.e., find a solution) we must specify values for parameters, initial conditions, and a stopping time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-1"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-1-1"><a href="#annotated-cell-1-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fu">list</span>(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-1-2" class="code-annotation-target"><a href="#annotated-cell-1-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">r =</span> <span class="dv">2</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-1-3" class="code-annotation-target"><a href="#annotated-cell-1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">K =</span> <span class="dv">10</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="3" onclick="event.preventDefault();" href="">3</a><span id="annotated-cell-1-4" class="code-annotation-target"><a href="#annotated-cell-1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">N0 =</span> .<span class="dv">1</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="4" onclick="event.preventDefault();" href="">4</a><span id="annotated-cell-1-5" class="code-annotation-target"><a href="#annotated-cell-1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Tend =</span> <span class="dv">10</span></span>
<span id="annotated-cell-1-6"><a href="#annotated-cell-1-6" aria-hidden="true" tabindex="-1"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-annotation="1" data-code-lines="2">intrinsic growth rate (per day)</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-annotation="2" data-code-lines="3">carrying capacity (some measure of biomass, e.g., thousands of individuals)</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-annotation="3" data-code-lines="4">initial population size (in the same units as <span class="math inline">\(K\)</span>)</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-annotation="4" data-code-lines="5">number of time units to simulate (days, since we must match the units chosen for <span class="math inline">\(r\)</span>)</span>
</dd>
</dl>
</div>
</div>
<p>At this point we could use a stock (canned) ODE solver from the ‘deSolve’ library. Instead, we’ll build our own discritizations. This let’s us explore a few technicalities and some mechanisms behind the carrying capacity.</p>
<p>The simplest discritization of the ODE model uses Euler’s method (a tangent line approximation) with a time step <span class="math inline">\(\tau\)</span>. <span class="math display">\[N(t+\tau) = N(t) + \tau rN(t)(1-N(t)/K)\]</span></p>
<p>We’ll wrap a single step of the discrete model in a function, using global values for parameters as defaults. <!-- 
#| lst-label: lst-logistic-euler
#| eval: true
#| lst-cap: "Foward Euler approximation to the Logistic Equation" 
--></p>
<div id="lst-logistic-euler" class="listing">
<p>Listing&nbsp;1: Foward Euler approximation to the Logistic Equation</p>
<div class="sourceCode" id="lst-logistic-euler" data-lst-cap="Foward Euler approximation to the Logistic Equation"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="lst-logistic-euler-1"><a href="#lst-logistic-euler-1" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="lst-logistic-euler" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="lst-logistic-euler-2" class="code-annotation-target"><a href="#lst-logistic-euler-2" aria-hidden="true" tabindex="-1"></a>logistic_euler <span class="ot">=</span> <span class="cf">function</span>(N, <span class="at">param =</span> <span class="cn">NULL</span>) {</span>
<a class="code-annotation-anchor" data-target-cell="lst-logistic-euler" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="lst-logistic-euler-3" class="code-annotation-target"><a href="#lst-logistic-euler-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(param,{</span>
<a class="code-annotation-anchor" data-target-cell="lst-logistic-euler" data-target-annotation="3" onclick="event.preventDefault();" href="">3</a><span id="lst-logistic-euler-4" class="code-annotation-target"><a href="#lst-logistic-euler-4" aria-hidden="true" tabindex="-1"></a>        N <span class="sc">+</span> tau<span class="sc">*</span>r<span class="sc">*</span>N<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>N<span class="sc">/</span>K)</span>
<a class="code-annotation-anchor" data-target-cell="lst-logistic-euler" data-target-annotation="4" onclick="event.preventDefault();" href="">4</a><span id="lst-logistic-euler-5" class="code-annotation-target"><a href="#lst-logistic-euler-5" aria-hidden="true" tabindex="-1"></a>      })</span>
<a class="code-annotation-anchor" data-target-cell="lst-logistic-euler" data-target-annotation="5" onclick="event.preventDefault();" href="">5</a><span id="lst-logistic-euler-6" class="code-annotation-target"><a href="#lst-logistic-euler-6" aria-hidden="true" tabindex="-1"></a>    }</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="lst-logistic-euler" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="lst-logistic-euler" data-code-annotation="1" data-code-lines="2">Wrap the model in a function to simplify later loops.</span>
</dd>
<dt data-target-cell="lst-logistic-euler" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="lst-logistic-euler" data-code-annotation="2" data-code-lines="3">Unwind the optional parameter list. The <code>with(param,</code> wrapper is a convenient way to pass a parameter list to the function while still having the default option of using globally defined parameters. If <code>param==NULL</code> the interpreter uses global values of <code>r</code> and <code>K</code></span>
</dd>
<dt data-target-cell="lst-logistic-euler" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="lst-logistic-euler" data-code-annotation="3" data-code-lines="4">The model is evaluated inside the <code>with</code> statement.</span>
</dd>
<dt data-target-cell="lst-logistic-euler" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="lst-logistic-euler" data-code-annotation="4" data-code-lines="5">close <code>with</code></span>
</dd>
<dt data-target-cell="lst-logistic-euler" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="lst-logistic-euler" data-code-annotation="5" data-code-lines="6">close <code>function</code></span>
</dd>
</dl>
<p>We can make a simple iterator to generate solutions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>stepper <span class="ot">=</span> <span class="cf">function</span>(f, <span class="at">param=</span><span class="cn">NULL</span>) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(param,{</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        times <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>,Tend,<span class="at">by=</span>tau)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>      n <span class="ot">=</span> <span class="fu">rep</span>(N0,<span class="fu">length</span>(times))</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(times)){</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>          n[t] <span class="ot">=</span> <span class="fu">f</span>(n[t<span class="dv">-1</span>],param)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">data.frame</span>(<span class="at">time =</span> times, <span class="at">population =</span> n)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice the discrete model has an additional parameter, <span class="math inline">\(\tau\)</span>. Let’s start with <span class="math inline">\(\tau\)</span> set to 0.5 days (12 hours) and generate a solution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>tau <span class="ot">=</span> <span class="fl">0.5</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">=</span> <span class="fu">stepper</span>(logistic_euler,p)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(res,<span class="at">type=</span><span class="st">'l'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-logistic-euler" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="BBSchoolProb2-1_files/figure-html/fig-logistic-euler-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Sample forecast from an Euler approximation</figcaption>
</figure>
</div>
</div>
</div>
<p>The choice of line segments for the plots is appropriate, since we are viewing our solution as a discrete time approximation, based on tangent lines, to a continuous solution of the ODE model.</p>
<p>Next, we’ll repeat the forecast with a larger time step and use <code>ggplot2</code> for fancier plots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>tau <span class="ot">=</span> p<span class="sc">$</span>tau    <span class="co"># add a column for the step size</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> res</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>tau <span class="ot">=</span> <span class="fl">1.0</span>      <span class="co"># change step size</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>res <span class="ot">=</span> <span class="fu">stepper</span>(logistic_euler,p)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>tau <span class="ot">=</span> p<span class="sc">$</span>tau</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">rbind</span>(data,res)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data,<span class="fu">aes</span>(<span class="at">x=</span>time,<span class="at">y=</span>population,<span class="at">color=</span><span class="fu">factor</span>(tau))) <span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">color=</span><span class="st">"step"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-logistic-euler-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="BBSchoolProb2-1_files/figure-html/fig-logistic-euler-2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Sample forecast from an Euler approximation with larger time step</figcaption>
</figure>
</div>
</div>
</div>
<p>To repeat the forecast with several time steps, or multiple parameter sets, we should wrap things up in a loop.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-5"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-5-1" class="code-annotation-target"><a href="#annotated-cell-5-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="annotated-cell-5-2"><a href="#annotated-cell-5-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (tau <span class="cf">in</span> <span class="fu">seq</span>(.<span class="dv">5</span>,<span class="fl">1.1</span>,<span class="at">by=</span>.<span class="dv">2</span>)) {</span>
<span id="annotated-cell-5-3"><a href="#annotated-cell-5-3" aria-hidden="true" tabindex="-1"></a>  p<span class="sc">$</span>tau <span class="ot">=</span> tau</span>
<span id="annotated-cell-5-4"><a href="#annotated-cell-5-4" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">=</span> <span class="fu">stepper</span>(logistic_euler,p)</span>
<span id="annotated-cell-5-5"><a href="#annotated-cell-5-5" aria-hidden="true" tabindex="-1"></a>  res<span class="sc">$</span>tau <span class="ot">=</span> tau</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-5-6" class="code-annotation-target"><a href="#annotated-cell-5-6" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">=</span> <span class="fu">rbind</span>(data,res)</span>
<span id="annotated-cell-5-7"><a href="#annotated-cell-5-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-5-8"><a href="#annotated-cell-5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data,<span class="fu">aes</span>(<span class="at">x=</span>time,<span class="at">y=</span>population,<span class="at">color=</span><span class="fu">factor</span>(tau))) <span class="sc">+</span></span>
<span id="annotated-cell-5-9"><a href="#annotated-cell-5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="annotated-cell-5-10"><a href="#annotated-cell-5-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">color=</span><span class="st">"step"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-5" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-annotation="1" data-code-lines="1">Setting a variable to <code>NULL</code> is a convenient way to initialize storage space for the results.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-annotation="2" data-code-lines="6">We can append each forecast to the end of the data frame to get the results in the <em>long format</em> ggplot likes. Use <code>cbind</code> to set things up for matplot.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div id="fig-logistic-euler-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="BBSchoolProb2-1_files/figure-html/fig-logistic-euler-3-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3: Sample forecasts from an Euler approximation with several time steps</figcaption>
</figure>
</div>
</div>
</div>
<div id="exr-1" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 1 </strong></span>Generate plots of the logistic growth model for each <span class="math inline">\(r\)</span> in <span class="math inline">\(\{1.95, 2.05, 2.5, 2.8\}\)</span> using the simple Forward Euler discritization and <span class="math inline">\(\tau=1\)</span>. You should write a script that uses a loop (or <code>apply</code>) to do this. Describe the trajectory observed in each case. Do the solutions remain between 0 and <span class="math inline">\(K\)</span>? Are the solutions strictly increasing or do they oscillate?</p>
</div>
</section>
<section id="a-more-logistic-like-discrete-model" class="level2">
<h2 class="anchored" data-anchor-id="a-more-logistic-like-discrete-model">A more logistic-like discrete model</h2>
<p>One quick fix to the problem of oscillations in simple Forward Euler discritzation is to use a semi-implicit method. <span class="math display">\[N(t+\tau) = N(t) + \tau rN(t)\left(1-\frac{N(t+\tau)}{K}\right)\]</span> Here we limit population growth based on the future population rather than the current population. Solving for <span class="math inline">\(N(t+\tau)\)</span> yields something similar to a Beverton-Holt discrete model. <span class="math display">\[N(t+\tau) = \frac{(1+ \tau r)N(t)}{1+\dfrac{\tau rN(t)}{K}}\]</span></p>
<div id="exr-2" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 2 </strong></span>Write a function similar to <code>logistic_euler</code> <a href="#lst-logistic-euler">Listing&nbsp;1</a> but using the semi-implicit method above. Generate plots from this discritization for the same values of <span class="math inline">\(r\)</span> as in the previous problem. Vary <span class="math inline">\(\tau\)</span> to see the effect on solutions.</p>
</div>
<div id="exr-3" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3 </strong></span>Show that if <span class="math inline">\(r&gt;0\)</span> and <span class="math inline">\(0 &lt; N(0) &lt; K\)</span> the semi-implicit model produces strictly increasing solutions. Hint, show <span class="math inline">\(N(t) &lt; N(t+\tau) &lt; K\)</span> provided <span class="math inline">\(0 &lt; N(0) &lt; K\)</span> and <span class="math inline">\(r &gt; 0\)</span>.</p>
</div>
</section>
<section id="a-process-based-approach-to-the-logistic-model" class="level2">
<h2 class="anchored" data-anchor-id="a-process-based-approach-to-the-logistic-model">A process-based approach to the logistic model</h2>
<p>Dividing the logistic term into separate birth and death terms gives a slightly more process-based definition of a carrying capacity. Suppose births are proportional to population and deaths increase quadratically with population. That is, <span class="math display">\[\frac{dN}{dt} = bN - dN -cN^2\]</span> where <span class="math inline">\(b\)</span> is the per capita birth rate and <span class="math inline">\(d+cN\)</span> is the per capita mortality rate. The equilibrium population is <span class="math inline">\(K = \frac{b-d}{c}\)</span> provided <span class="math inline">\(b &gt; d\)</span>. Unlike the usual <span class="math inline">\(r\)</span>-<span class="math inline">\(K\)</span> formulation of the logistic model, this model still makes perfect sense if <span class="math inline">\(b &lt; d\)</span>.</p>
<p>A simple semi-implicit discritization that preserves the monotonicity of the logistic solutions and avoids similar numerical instabilities for <span class="math inline">\(b &lt; d\)</span> is the following: <span class="math display">\[N(t+\tau) = N(t) + \tau bN(t) - \tau dN(t+\tau) - \tau cN(t)N(t+\tau)\]</span> <span class="math display">\[N(t+\tau) = \frac{ (1 + \tau b)N(t) }{ 1 + \tau d + \tau cN(t) }\]</span></p>
<div id="exr-4" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 4 </strong></span>Show that if <span class="math inline">\(b &lt; d\)</span> and <span class="math inline">\(N(t) &gt; 0\)</span> then <span class="math inline">\(0 &lt; N(t+\tau) &lt; N(t)\)</span>. This guarantees we generate a strictly positive and decreasing sequence of populations consistent with the ODE model. The same isn’t true of the earlier discritizations.</p>
</div>
<div id="exr-5" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 5 </strong></span>Show that if <span class="math inline">\(b &gt; d\)</span> and <span class="math inline">\(0 &lt; N(t) &lt; K = \frac{b-d}{c}\)</span> then <span class="math inline">\(N(t) &lt; N(t+\tau) &lt; K\)</span>. Again consistent with the ODE model.</p>
</div>
</section>
</section>
<section id="parameter-uncertainty" class="level1">
<h1>Parameter Uncertainty</h1>
<p>This section of the problem set is taken (almost) directly from <a href="https://github.com/EcoForecast/EF_Activities/blob/master/Exercise_02_Logistic.Rmd">Dietz’s Exercise set 2</a></p>
<section id="probability-distributions-in-r" class="level2">
<h2 class="anchored" data-anchor-id="probability-distributions-in-r">Probability distributions in R</h2>
<p>Now that we know how to run a model forward, we need a way to incorporate one of the most basic features of what makes a forecast a forecast – that forecasts should use probabilities to incorporate uncertainties.</p>
<p>Because it is a statistical language, there are a large number of probability distributions in R by default and an even larger number that can be loaded from packages. The table below gives a listing of the most common distributions in R, the name of the function within R, and the parameters of the distribution.</p>
<table class="table">
<thead>
<tr class="header">
<th>Distribution</th>
<th>R name</th>
<th>Parameters</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>beta</td>
<td>beta</td>
<td>shape1, shape2, ncp</td>
</tr>
<tr class="even">
<td>Binomial</td>
<td>binom</td>
<td>size, prob</td>
</tr>
<tr class="odd">
<td>Cauchy</td>
<td>cauchy</td>
<td>location, scale</td>
</tr>
<tr class="even">
<td>chi-squared</td>
<td>chisq</td>
<td>df, ncp</td>
</tr>
<tr class="odd">
<td>exponential</td>
<td>exp</td>
<td>rate</td>
</tr>
<tr class="even">
<td>F</td>
<td>f</td>
<td>df1, df2, ncp</td>
</tr>
<tr class="odd">
<td>gamma</td>
<td>gamma</td>
<td>shape, scale</td>
</tr>
<tr class="even">
<td>geometric</td>
<td>geom</td>
<td>prob</td>
</tr>
<tr class="odd">
<td>hypergeometric</td>
<td>hyper</td>
<td>m, n, k</td>
</tr>
<tr class="even">
<td>log-normal</td>
<td>lnorm</td>
<td>meanlog, sdlog</td>
</tr>
<tr class="odd">
<td>logistic</td>
<td>logis</td>
<td>location, scale</td>
</tr>
<tr class="even">
<td>Negative binomial</td>
<td>nbinom</td>
<td>size, prob</td>
</tr>
<tr class="odd">
<td>Normal</td>
<td>norm</td>
<td>mean, sd</td>
</tr>
<tr class="even">
<td>Poisson</td>
<td>pois</td>
<td>lambda</td>
</tr>
<tr class="odd">
<td>Student’s t</td>
<td>t</td>
<td>df, ncp</td>
</tr>
<tr class="even">
<td>uniform</td>
<td>unif</td>
<td>min, max</td>
</tr>
<tr class="odd">
<td>Weibull</td>
<td>weibull</td>
<td>shape, scale</td>
</tr>
<tr class="even">
<td>Wilcoxon</td>
<td>wilcox</td>
<td>m, n</td>
</tr>
</tbody>
</table>
<p>There is a good chart at <a href="http://www.johndcook.com/distribution_chart.html" class="uri">http://www.johndcook.com/distribution_chart.html</a> that describes the relationships among the common distributions, and the Wikipedia articles for most of them are good for quick reference.</p>
<p>R actually provides four related functions for each probability distribution. These functions are called by adding a letter at the beginning of the function name. The variants of each probability distribution are:</p>
<ul>
<li>“d” = density: probability density function (PDF)</li>
<li>“p” = cumulative distribution function (CDF)</li>
<li>“q” = quantile: calculates the value associated with a specified tail probability, inverse of “p”</li>
<li>“r” = random: simulates random numbers</li>
</ul>
<p>The first argument to these functions is the same regardless of the distribution and is x for “d”, q for “p”, p for “q”and n for “r”</p>
<p>All of this will make more sense once we consider a concrete example. Let’s take a look at the normal probability density function first, since it’s the one you’re most familiar with. If you use <code>?dnorm</code> you’ll see that for many of the function arguments there are default values, specifically mean=0 and sd=1. Therefore if these values are not specified explicitly in the function call R assumes you want a standard Normal distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>,<span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,<span class="fu">dnorm</span>(x),<span class="at">type=</span><span class="st">'l'</span>)       <span class="do">## that’s a lowercase “L” for “line”</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>)                         <span class="do">## add a line to indicate the mean (“v” is for “vertical”)</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x,<span class="fu">dnorm</span>(x,<span class="dv">2</span>),<span class="at">col=</span><span class="dv">2</span>)           <span class="do">## try changing the mean (“col” sets the color)</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">2</span>,<span class="at">col=</span><span class="dv">2</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x,<span class="fu">dnorm</span>(x,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>),<span class="at">col=</span><span class="dv">3</span>)    <span class="do">## try changing the mean and standard dev</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="sc">-</span><span class="dv">1</span>,<span class="at">col=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BBSchoolProb2-1_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This plot of the normal distribution and the effects of varying the parameters in the normal are both probably familiar to you already – changing the mean changes where the distribution is centered while changing the standard deviation changes the spread of the distribution. Next try looking at the CDF of the normal:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,<span class="fu">pnorm</span>(x,<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">type=</span><span class="st">'l'</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x,<span class="fu">pnorm</span>(x,<span class="dv">2</span>,<span class="dv">1</span>),<span class="at">col=</span><span class="dv">2</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">2</span>,<span class="at">col=</span><span class="dv">2</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x,<span class="fu">pnorm</span>(x,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>),<span class="at">col=</span><span class="dv">3</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="sc">-</span><span class="dv">1</span>,<span class="at">col=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BBSchoolProb2-1_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Next let’s look at the function qnorm. Since the input to this function is a quantile, the x-values for the plot are restricted to the range [0,1].</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.01</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p,<span class="fu">qnorm</span>(p,<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">type=</span><span class="st">'l'</span>,<span class="at">ylim=</span><span class="fu">range</span>(x))    <span class="co"># ylim sets the y-axis range</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># range returns the min/max as a 2-element vector</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)                     <span class="co"># “h” for “horizontal”</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(p,<span class="fu">qnorm</span>(p,<span class="dv">2</span>,<span class="dv">1</span>),<span class="at">col=</span><span class="dv">2</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">2</span>,<span class="at">col=</span><span class="dv">2</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(p,<span class="fu">qnorm</span>(p,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>),<span class="at">col=</span><span class="dv">3</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="sc">-</span><span class="dv">1</span>,<span class="at">col=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BBSchoolProb2-1_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As you can see, the quantile function is the inverse of the CDF. This function can be used to find the median of the distribution (p = 0.5) or to estimate confidence intervals at any level desired.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qnorm</span>(<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>),<span class="dv">0</span>,<span class="dv">1</span>)           <span class="co"># what width CI is specified by these values?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1.959964  1.959964</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p,<span class="fu">qnorm</span>(p,<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">type=</span><span class="st">'l'</span>,<span class="at">ylim=</span><span class="fu">range</span>(x))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>),<span class="at">lty=</span><span class="dv">2</span>)  <span class="co"># add vertical lines at the CI</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fu">qnorm</span>(<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>)),<span class="at">lty=</span><span class="dv">2</span>)   <span class="co">#add horizontal lines at the threshold vals</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BBSchoolProb2-1_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,<span class="fu">dnorm</span>(x,<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">type=</span><span class="st">'l'</span>)       <span class="co"># plot the corresponding pdf</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">qnorm</span>(<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>)),<span class="at">lty=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BBSchoolProb2-1_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Finally, let’s investigate the rnorm function for generating random numbers that have a normal distribution. Here we generate histograms that have a progressively larger sample size and compare that to the actual density of the standard normal.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">1000</span>,<span class="dv">10000</span>)    <span class="co"># sequence of sample sizes</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){          <span class="co"># loop over these sample sizes</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(<span class="fu">rnorm</span>(n[i]),<span class="at">main=</span>n[i],<span class="at">probability=</span><span class="cn">TRUE</span>,<span class="at">breaks=</span><span class="dv">40</span>)  </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                <span class="co">#here breaks defines number of bins in the histogram</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(x,<span class="fu">dnorm</span>(x),<span class="at">col=</span><span class="dv">2</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BBSchoolProb2-1_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="BBSchoolProb2-1_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="BBSchoolProb2-1_files/figure-html/unnamed-chunk-11-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="BBSchoolProb2-1_files/figure-html/unnamed-chunk-11-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>One other technical note: like any function in R that generates random output, this example will give different results every time you run it.</p>
<p>This example demonstrates that as the number of random draws from a probability distribution increases, the histogram of those draws provides a better and better approximation of the density itself. We will make use of this fact extensively this semester because – as odd as this may sound now – there are many distributions that are easier to randomly sample from than solve for analytically.</p>
<div id="exr-prob-2" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 6 </strong></span>Choose another probability distribution from the table above and generate graphs of the probability density function, the cumulative distribution function, the quantile function, and a histogram of samples from that distribution.</p>
</div>
</section>
<section id="monte-carlo-simulation" class="level2">
<h2 class="anchored" data-anchor-id="monte-carlo-simulation">Monte Carlo Simulation</h2>
<p>Most of the figures from the logistic growth example in Chapter 2 included plots of the median trajectory and 95% interval estimates. These summary statistics are a reflection of the fact that the underlying model prediction was a timeseries of probability distributions, rather than a single trajectory. So how do we project a probability distribution through time?</p>
<p>In Chapter 11 we will explore a variety of analytical and numerical approaches to propagating uncertainty, and the trade-offs among them, in much greater detail. Today I wanted to introduce a particularly common and general numerical approach, <strong>Monte Carlo</strong> simulation. A Monte Carlo method is any algorithm that relys on randomization to approximate a computation. These approaches and other will be discussed in more detail later (e.g.&nbsp;Chapters 5, 11, 13, &amp; 14).</p>
<p>The previous example of approximating the Normal distribution with a histogram of samples from the Normal distribution is a simple illustration of this approach. What makes this approach powerful is that we can transform the samples from a distribution through whatever function we would like and the resulting set of samples is the correct histogram for that transformation. This is important because, by contrast, we <strong>cannot</strong> transform the summary statistics, such as the mean of the probability distribution, through an arbitrary function because of <strong>Jensen’s Inequality</strong>.</p>
<p>To illustrate this point, consider the function x^2 and a standard Normal distribution (mean = 0, sd = 1). Now if we ignore Jensen’s Inequality and transform the mean and 95% CI we’d end up with a probability distribution that has a mean of 0^2 = 0, a lower confidence interval of -1.96^2 = 3.84 and an upper confidence interval of 1.96^2 = 3.84. Clearly this can’t be correct, since the upper and lower CI are identical and the lower CI is higher than the mean. By contrast, if we do this transformation numerically</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(x,<span class="at">main=</span><span class="st">"Original distribution"</span>,<span class="at">breaks=</span><span class="dv">40</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">quantile</span>(x,<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.5</span>,<span class="fl">0.975</span>)),<span class="at">lty=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">lwd=</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">"orange"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">mean</span>(x),<span class="at">col=</span><span class="st">"red"</span>,<span class="at">lwd=</span><span class="dv">3</span>,<span class="at">lty=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BBSchoolProb2-1_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(y,<span class="at">main=</span><span class="st">"Transformed distribution"</span>,<span class="at">breaks=</span><span class="dv">40</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">quantile</span>(y,<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.5</span>,<span class="fl">0.975</span>)),<span class="at">lty=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">lwd=</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">"orange"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">mean</span>(y),<span class="at">col=</span><span class="st">"red"</span>,<span class="at">lwd=</span><span class="dv">3</span>,<span class="at">lty=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BBSchoolProb2-1_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The Monte Carlo estimate is that the mean is 0.9988875, the median is 0.4574323, and the 95% CI is 0.001046, 5.0408616.</p>
<p>It turns out that this specific transformation (x^2 of a standard Normal), has a well known analytical solution – a Chi-squared distribution with one degee of freedom, so in this case we can compare the numerical approximation with the exact solution. This Chi-squared has a mean of 1, a median of 0.4549364 and a 95% CI of 9.8206912^{-4}, 5.0238862.</p>
<div id="exr-prob-3" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7 </strong></span>Numerically transform a lognormal(meanlog=0,sdlog=0.5) through sin(x) using Monte Carlo simulation. Include histograms of the original and transformed distributions. Report the mean, median, and 95% CI for both distributions and indicate these values on the histograms.</p>
</div>
</section>
<section id="parameter-error" class="level2">
<h2 class="anchored" data-anchor-id="parameter-error">Parameter error</h2>
<p>We next want to use the Monte Carlo approach to account for parameter uncertainty in the logistic growth model</p>
<p>To begin, we need to specify the uncertainty in the model parameters and the size of the simulation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>r    <span class="ot">=</span> <span class="fl">1.0</span>     <span class="do">## make sure to return r to it's original value</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>K <span class="ot">=</span> <span class="dv">10</span>        <span class="do">## carrying capacity      </span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>n0 <span class="ot">=</span> .<span class="dv">1</span>       <span class="do">## initial population size</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>NT <span class="ot">=</span> <span class="dv">30</span>       <span class="do">## number of time steps to simulate</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>time <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>NT</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>r.sd <span class="ot">=</span> <span class="fl">0.2</span>     <span class="do">## standard deviation on r</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>K.sd <span class="ot">=</span> <span class="fl">1.0</span>     <span class="do">## standard deviation on K</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>NE <span class="ot">=</span> <span class="dv">1000</span>      <span class="do">## Ensemble size</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to run the Monte Carlo simulation for the logistic. In this case we’ll be running the logistic growth model 1000 times, each time with slightly different parameters. We’ll then store all 1000 trajectories in a matrix. In effect, we’ll be estimating our probability distributions and all of our summary statistics from a sample of time-series, rather than a sample of points as we did in the previous example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">matrix</span>(n0,NE,NT)   <span class="co"># storage for all simulations</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>rE <span class="ot">=</span> <span class="fu">rnorm</span>(NE,r,r.sd)  <span class="co"># sample of r</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>KE <span class="ot">=</span> <span class="fu">rnorm</span>(NE,K,K.sd)  <span class="co"># sample of K</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NE){        <span class="co"># loop over ensemble members</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>NT){      <span class="co"># for each ensemble member, simulate throught time</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    n[i,t] <span class="ot">=</span> <span class="fu">max</span>(<span class="dv">0</span>,n[i,t<span class="dv">-1</span>] <span class="sc">+</span> rE[i]<span class="sc">*</span>n[i,t<span class="dv">-1</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>n[i,t<span class="dv">-1</span>]<span class="sc">/</span>KE[i]))</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the use of the <code>max</code> function in the simulation above ensures that population extinction events stay at 0, rather than generating negative individuals.</p>
<p>Next we’ll use <em>apply</em> to calculate the median and CI for each time point.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>n.stats <span class="ot">=</span> <span class="fu">apply</span>(n,<span class="dv">2</span>,quantile,<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.5</span>,<span class="fl">0.975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Unfortunately, R doesn’t have a built in function for plotting shaded CI on time-series plots, so we’ll define one. Unlike plot, which just takes x and y as arguments, this function need to take time-series for both the upper (yhi) and lower (ylo) intervals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ciEnvelope <span class="ot">&lt;-</span> <span class="cf">function</span>(x,ylo,yhi,<span class="at">col=</span><span class="st">"lightgrey"</span>,...){</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">polygon</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(x, <span class="fu">rev</span>(x), x[<span class="dv">1</span>]), <span class="fu">c</span>(ylo, <span class="fu">rev</span>(yhi),</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  ylo[<span class="dv">1</span>])), <span class="at">border =</span> <span class="cn">NA</span>,<span class="at">col=</span>col,...) </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="exr-prob-4" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 8 </strong></span>Plot histograms of the samples of r and K used for the simulation.</p>
</div>
<div id="exr-prob-5" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 9 </strong></span>Plot a sample of 10 different trajectories (through time) from your ensemble (on one graph).</p>
</div>
<div id="exr-prob-6" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 10 </strong></span>Plot a histogram of your population forecast at time = 15.</p>
</div>
<div id="exr-prob-7" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 11 </strong></span>Plot the median trajectory through time. Use <code>ciEnvelope</code> to add a 95% CI (i.e.&nbsp;2.5% to 97.5%) to the plot. This function need to take time-series for both the upper (yhi) and lower (ylo) intervals.</p>
</div>
</section>
<section id="initial-conditions" class="level2">
<h2 class="anchored" data-anchor-id="initial-conditions">Initial conditions</h2>
<p>The approach for simulating uncertainty in the initial conditions is very similar to the approach used for the parameter uncertainty. As in Chapter 2, we’ll assume that the initial condition is distributed as a lognormal to ensure that we never draw negative values. For this example we’ll assume a standard deviation of 0.6 and an intrinsic growth rate of 0.3</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">=</span> <span class="fl">0.3</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>n0.sd <span class="ot">=</span> <span class="fl">0.6</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>n0s <span class="ot">=</span> <span class="fu">rlnorm</span>(NE,<span class="fu">log</span>(n0),n0.sd)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">matrix</span>(n0s,NE,NT)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NE){</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>NT){</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    n[i,t] <span class="ot">=</span> <span class="fu">max</span>(<span class="dv">0</span>,n[i,t<span class="dv">-1</span>] <span class="sc">+</span> r<span class="sc">*</span>n[i,t<span class="dv">-1</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>n[i,t<span class="dv">-1</span>]<span class="sc">/</span>K))</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="exr-prob-8" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 12 </strong></span>Plot the median and 95% interval.</p>
</div>
<div id="exr-prob-9" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 13 </strong></span>Repeat with <span class="math inline">\(r \in \{1.95, 2.05, and 2.8\}\)</span></p>
</div>
<!--

## Latin Hypercube Sampling


::: {.cell}

```{.r .cell-code}
library(lhs)
samples = 20
parameters = 3
lhs = randomLHS(n=samples,k=parameters)
```
:::


-->
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>